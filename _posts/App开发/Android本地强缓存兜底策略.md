## 背景

无网、限流等异常情况下，页面会显示空白，尤其是首页，体验不太好。电商APP的首页基本都都在变化，所以基本不走默认的Http缓存策略。为了提升体验，APP端提供一个兼容兜底方案：**在出错的情况下**，提供本地缓存，以提高用户体验。

## Native强缓存兜底策略

### 适用场景

* 无网情况
* 网络请求出错、包括各种限流、数据问题等

### 使用原则

* 错误问题不应暴露给用户
* 错误问题需要暴露给开发 
* 兼容ABT以及数据埋点

### 埋点问题 、ABT问题

> 理念：假设进程一直没死，复现现场：ABT、埋点与数据 
 
* ABT、数据埋点保持一致
* 一旦启用首页缓存，则启用就ABT

### 实现方案

标准的HTTP缓存策略已经在线上，并没有太合适的场景，基本没用起来，但是这部分逻辑还是倾向于保留，所以本地改动建立在原逻辑的基础上，仅仅作为异常兜底，大致流程示意如下：

![](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/d1120064447a4f5c8f5cf7f95ceefeec~tplv-k3u1fbpfcp-zoom-1.image)

> 细节

* Native强制缓存上限为一个月 
* 每次请求成功都会更新缓存
* 缓存的白名单本地维护
* 启用本地缓存成功后（一般是首页），需要恢复上次ABT，模拟APP一直存活
 
 
 