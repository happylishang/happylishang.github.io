# 背景、能力、难点、实践、收益、展望


### 背景：APP端上安全在谈什么

APP的每个业务场景都有其既定的运行模式，若被人为破坏就可认为它是不安全的。举个栗子，比如秒杀场景：大量用户在特定时间点，通过点击抢购来秒杀优惠商品，从而营造一种紧迫而有噱头的营销场景，但如果能通过非法手段自动抢购、甚至提前开始刷接口抢购，那就彻底破坏了业务的玩法，这就是一种不安全的运行模式。再比如常用的用户拉新场景：新客获取成本高达200左右，所有产品的拉新投入都蛮高，如何获得真正的新用户而不是羊毛党也是拉新必须处理的事，一般而言，新设备+新账户是新用户的基本条件，但新账户的成本其实不高，大部分是要靠新设备来识别的，但如果能通过非法手段不断模拟新设备，那拉新投入带来的新用户可能大部分都是无效的羊毛党，这也可看做是一种不安全的运行场景，甚至还有二次篡改，构建马甲APP等各种场景。APP端上安全要做的就是甄别并防范这种异常场景的发生，简而言之它就是：一种确保**官方APP**在**既定业务模型**中运行的能力。

### APP端上安全体系应该具备哪些能力

一个安全体系要具备哪些能力呢，简单说可分两块：**甄别与防御**。即一：甄别运行环境是否安全的能力，二：针对不同的场景作出不同的防御的能力，场景千变万化，所以防御手段也没有一剑破万法的能力，基本都要根据具体的风险场景，产出不同的应对方案，但是整体涉及的流程基本一致，如下：

![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/2117dc50f5f844cfae3662459ee8560c~tplv-k3u1fbpfcp-watermark.image?)

要做的事情就是围绕四个阶段构建不同的能力。先看第一阶段：风险场景的假设，预判有哪些风险场景，从AppStore或者官方应用市场下载，安装、正常使用，这是理想中的运行模式，但不安分的用户千千万，异常场景也多变，不存在一剑破万法的说法，这里人为做了一些场景归类：


![image.png](https://p9-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/6a7f8761abe14ba38424619bee19d2ca~tplv-k3u1fbpfcp-watermark.image?)

简单来说可分以上四类，所以**安全模型必须能覆盖上述风险**，即

>一： 运行的APP非官方应用

这种情况一般是非法用户为了谋求特定的权益，对原装APP进行魔改二次打包后发布，这对于一些广告类、离线付费类APP是一种毁灭性的打击，最常见的就是一些APP会在闪屏页面投放广告，从而获取收益，但一旦这个业务逻辑被篡改绕过，那么广告收益直接归零；还有些情况APP被碰瓷，魔改一些功能，跳转到非官方设定的网站，比如在比较火的APP添加劫持逻辑，跳转到一些黄赌网站，这给官方APP带来的负面影响是难易估量的，如果不能自证清白，甚至还会面临法律上的追责。

> 二：业务的运转模型被篡改

简单的讲就是没有按照产品的既定玩法进行，就像文章开头的秒杀场景【电商平台的茅台抢购】，如果能通过API直接组单，那APP里点击的那批用户无论如何也抢不过插件；再比如有些签到的场景是为了促活，如果通过自动签到工具自动打卡，那促活的目的也无法达到，这也是要重点防控的一个场景。

> 三：运行的设备非目标设备

这种场景主要影响一些拉新、优惠权益等，甚至直接影响整体运营策略，简单举个例子，拉新场景中会投放大量的新人免单、直减券，基本等于免费领取权益，比如我们都经历过的打车软件、外卖软件、新电商产品上线等。全国有无数的专业羊毛党专注于这一场景，他们掌握大量手机号，可以注册大量新账号，同时能通过虚拟机、应用多开、复刻设备等手段无限冒充新设备，如果不加反制，优惠策略一上线，各种券基本全被这批人掠夺，被这种手段折磨致死的产品数不胜数，也几乎是每个电商平台的噩梦。

> 四：一些核心逻辑的泄漏

这不是端上特有的风险，比如代码泄漏这种，各方都有这种风险，只不过端上风险更高，因为APP是要上架发出去的，虽然经历过各种混淆与保护，但是用户最终还是能拿到可执行的APP包的，里面各种的核心的逻辑、秘钥都有潜在泄漏的风险，一旦泄漏，也是一种毁灭性的打击，比如某些音视频软件特有滤镜、转场、特效，这些算法是一个产品的核心，一旦破解，产品优势不再，如果防止逻辑代码的泄漏与破解也是安全必须关注的点。

覆盖了上面的场景后，相应的要提供甄别这些风险场景的能力，**针对不同的场景，抽象特征值，搜集上报，根据特定的模型推导出端上操作是否安全**，之后做出对应的响应，比如直接退出应用，或者标记为风险有用户，阻断其后续流程。


### 建设方案

* 甄别
* 捕获
* 防御：主动与被动

Android生态 电商类的业务通常会有各种的权益、优惠为了获取

所有权益及资产类的业务都避免不了与后端的交互，




####  工程安全：人员管理+代码管理
#### proguard入手，这是最简单的加密，成本最低，而且可以比较有效的扼杀一些在破解边缘徘徊的初级破解者，让他们能够悬崖勒马，浪子回头，然而，对于真正想要破解的人来说，混淆只等于加大了一点阅读难度而已， 相信做开发的同学基本上也都反编译过别人家的App，通过像jadx、apktool、dex2jar这样的反编译工具  到对于主流的加固技术，相应的破解技术也是非常成熟的，所以说，虽然技术很牛逼，但只要破解者知道了你加固的方式，就可以轻而易举的找到破解的方法，也就是比proguard多了一次Google的过程。
####  运行时安全
####  反向侦测：
####  防刷  
####  真机识别：
####  设备指纹
####  运行环境
####  核心信息加密
####  代码隔离
####  用户行为 埋点+人机系别
#### 核心算法逻辑的安全

# AndroidKeyStore


# 量子加密、白盒加密、人工智能分析，这些基本都是下一代的安全策略，就当前来说，还比较虚幻，不过只要技术一旦成熟，一定将是划时代的里程碑。

 
 