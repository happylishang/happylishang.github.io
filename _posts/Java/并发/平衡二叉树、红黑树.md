### 概念

* 红黑树（Red Black Tree） 是一种自平衡二叉查找树，是在计算机科学中用到的一种数据结构，典型的用途是实现关联数组。 
* 红黑树是在1972年由Rudolf Bayer发明的，当时被称为平衡二叉B树（symmetric binary B-trees）。后来，在1978年被 Leo J. Guibas 和 Robert Sedgewick 修改为如今的“红黑树”。 
* 红黑树是一种特化的AVL树（平衡二叉树），都是在进行插入和删除操作时通过特定操作保持二叉查找树的平衡，从而获得较高的查找性能 
* 它虽然是复杂的，但它的最坏情况运行时间也是非常良好的，并且在实践中是高效的： 它可以在O(log n)时间内做查找，插入和删除，这里的n 是树中元素的数目

### 平衡二叉树

二叉查找树充分了利用二分法的思维提升了数据查找的效率，不过我们在构建二叉树的时候就会发现很容易出现一个问题， 就是二叉查找树的“高度”不稳定，同样的数据插入的先后顺序不一样，就很有可能变成下图一样的结构。平衡二叉树又称AVL树。它可以是一颗空树，或者具有以下性质的二叉排序树：它的左子树和右子树的高度之差(平衡因子)的绝对值不超过1且它的左子树和右子树都是一颗平衡二叉树。


如果树的节点变成线性结构，那么就会极大的降低我们的查询效率，所以我们必须要有一种方式来保证二叉树节点的平衡，让树的节点高度差不会太大，这个时候就衍生了一些平衡算法，最终我们的二叉树就有像AVL树和红黑树这些新产品，我们也称这些新产品为平衡二叉树，，平衡二叉树通常会保证树的左右两边的节点层级相差不会大于1。

* 平衡二叉树又称AVL树
* 平衡二叉树必须是二叉**排序树**
* 每个节点的左子树和右子树的高度差至多为1。


平衡因子 = 左子树深度/高度 - 右子树深度/高度

在构建一棵平衡二叉树的过程中，当有新的节点要插入时，检查是否因插入后而破坏了树的平衡，如果是，则需要做旋转去改变树的结构， 左旋简单来说就是将节点的右支往左拉，右子节点变成父节点，并把晋升之后多余的左子节点出让给降级节点的右子节点，右旋类似，如果插入导致了失衡，则需要旋转来解决，对失衡节点来说，**儿子变父亲，孙子变儿子**。
	
* LL 插入节点在最小失衡子树中左子树的左子树结点下是左左 **单次右旋可调整**
* LR 插入节点在最小失衡子树中左子树的右子树结点下是左右 **先左旋再右旋可调整**
* RR 插入节点在最小失衡子树中右子树的右子树结点下是右右 **单次左旋可调整**
* LL 插入节点在最小失衡子树中右子树的左子树结点下是右左 **先右旋再左旋可调整**
 
第一个左右是最小失衡树的左右子树的意思，第二个左右是左右子树的左右子树。右右、左左只需要旋转一次就可以平衡，左右、右左要旋转两次才能把树调整平衡！，往哪边旋转，要摘掉上升侧哪边的子树，将其转移给下移的节点，说白了，就是将导致失衡的点作为中心，提上来，重新作为天平的中心，然后将提上来的多余枝丫补偿给落下去的点。

### 最小失衡子树

最小失衡子树：在新插入的结点向上查找，以第一个平衡因子的绝对值超过 1 的结点为根的子树称为最小不平衡子树。也就是说，一棵失衡的树，是有可能有多棵子树同时失衡的。而这个时候，我们只要调整最小的不平衡子树，就能够将不平衡的树调整为平衡的树。平衡二叉树的失衡调整主要是通过旋转最小失衡子树来实现的。根据旋转的方向有两种处理方式，左旋 与 右旋 


最小失衡树：之前深度相差值为1 ，插入后，变成了2，


### 递归是树操作最常用的工具


![](https://picx1.zhimg.com/80/v2-1ad28b5063f58925acfbc5df639f61ec_1440w.webp?source=1940ef5c)

递归是：先递进，再回归

模型一：在递去的过程中解决问题function recursion(大规模){
  
    if (end_condition){      // 明确的递归终止条件
        end;   // 简单情景
    }else{            // 在将问题转换为子问题的每一步，解决该步中剩余部分的问题
        solve;                // 递去
        recursion(小规模);     // 递到最深处后，不断地归来
    }
}

模型二： 在归来的过程中解决问题function recursion(大规模){
   
    if (end_condition){      // 明确的递归终止条件
        end;   // 简单情景
    }else{            // 先将问题全部描述展开，再由尽头“返回”依次解决每步中剩余部分的问题
        recursion(小规模);     // 递去
        solve;                // 归来
    }
}

 


### 红黑树

红黑树（Red Black Tree） 是一种自平衡二叉查找树，是在计算机科学中用到的一种数据结构，典型的用途是实现关联数组
红黑树是一种平衡二叉查找树的变体，它的左右子树高差有可能大于 1，所以红黑树不是严格意义上的平衡二叉树（AVL），但 对之进行平衡的代价较低， 其平均统计性能要强于 AVL ，因为红黑树是一种特化的二叉查找树，所以红黑树上的只读操作与普通二叉查找树相同

* （1）根节点与叶子节点（NIL）是黑色 [叶子节点，是指为空(NIL或NULL)的叶子节点！]
* （2）红色子节点必须是黑色
* （3）从一个节点到该节点的子孙节点的所有路径上包含相同数目的黑节点。
 
性质（2)导致了路径不能有两个毗连的红色节点，最短的可能路径都是黑色节点，最长的可能路径有交替的红色和黑色节点，性质（3）规定最长的路径与最短路径都有相同数目的黑色节点，红色不可能多与黑色，这就表明了没有路径能多于任何其他路径的两倍长。同平衡二叉树相比，红黑树更注重**黑色节点量一致**。
 
###  红黑树插入原则

插入时：插入的结点一定是红色的，如果插入的结点是根节点，将颜色改为黑色，插入的结点的父结点是黑色的，则插入完成，**插入的结点的父结点是红色的，则需要调整修复**，直到为根或满足规则。在需要修复的场景中，cur 的祖父结点即父亲的父亲（grandpa）一定是黑色，否则插入前已经违反了红黑树的规则，修复操作前和修复操作后的黑色结点的数量要保持不变。


# 参考文档


[数据结构与算法之二叉树遍历，深度与结点个数统计（实践上篇](https://bbs.huaweicloud.com/blogs/357407)